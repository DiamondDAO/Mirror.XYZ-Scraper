"{\"content\":{\"body\":\"## 导读\\n\\n我们可以简单的将区块链公链理解为一套分布式存储的账本，每个节点在各自本地存储一份账本。这些节点为了保障全网的账本一致性，就需要进行共识。共识的过程需要网络的不同节点之间交换信息，所以导致执行记账和计算的效率不高。\\n\\n对于软件系统而言，描述其系统吞吐量一般用 TPS（ 每秒事务处理量 TransactionPerSecond ） 性能指标。具体来说，比特币系统每秒仅支持 7 笔交易，以太坊也仅支持每秒 15 笔左右的交易。这样的 TPS 显然无法满足大型商业应用的需求。\\n\\n在这种历史背景下，为区块链系统扩容被提上了日程。目前业内主要的扩容方案有两类 ：\\n\\n* 链上扩容 / Layer1 一层扩容\\n\\n  即对区块链本身进行改造，从而直接提升链上交易处理速度 ：直接增加链上区块内可以包含的交易数量（ 如隔离见证 、扩块）、直接改变区块链的链体结构（ 如分片 Sharding 、有向无环图 DAG ）、直接改变区块链的共识机制（ 如 EOS 的 DPoS 、Solana 的 PoH ）等方案。\\n* 链下扩容 / Layer2 二层扩容（ 以太坊实现扩容时将源代码文件夹命名为 Layer2 ）\\n\\n  即将链上的相当一部分工作量转移到链下来完成，从而间接提升链上交易处理速度 ：State Channel（ 状态通道 ）、Plasma 、Rollup。具体如下图所示 ：\\n\\n![](https://images.mirror-media.xyz/publication-images/VVj7Lb3K0968p2Px268ew.png?height=654&width=778)\\n\\nif(DAO) 希望通过本篇内容解释上图中 “ zkRollup ” 分支里基于 zk-SNARK 实现 Layer2 方案的基本工作原理。\\n\\nzk是零知识证明的缩写（ZKP ：Zero-Knowledge Proof），Rollup 字面意思是 “ 一卷 ” ，通俗讲就是将链下一大堆转账交易记录压缩为一个批量，然后将这个批量交易打包、压缩后上链存储、验证。\\n\\n> 上图中的 Groth 16 、PLONK 都属于 zk-SNARKs 协议族，他们的数学理论基础都是基于椭圆曲线的 ；STARK 是零知识证明的另外一种实现算法，数学理论基础是离散函数并且无需可信设置。\\n>\\n> 关于 ZKP 和 zk-SNARK 协议的演进过程和底层原理，可以详见 if(DAO) 之前的文章 ：\\n\\n[https://mirror.xyz/0xd05cFA28Eaf8B4eaFD8Cd86d33c6CeD1a1875417/X3qSOjObTknXQ_iGhDBFYETibD0TVW0twz5QDIthjGI](https://mirror.xyz/0xd05cFA28Eaf8B4eaFD8Cd86d33c6CeD1a1875417/X3qSOjObTknXQ_iGhDBFYETibD0TVW0twz5QDIthjGI)\\n\\n## Ethereum 的 “ 状态 ” 和 “ 历史 ”\\n\\n我们以 Ethereum 公链为例。\\n\\nEthereum 的状态，也叫做「世界状态」，指的是 Ethereum 全量账本当前的样子。\\n\\n1、Ethereum 的状态是由账户构成的一棵 Merkle 树（账户是叶子），账户里面不仅记录了余额（代表一定数量的 ether），还记录了合约的数据（例如每一只加密猫的数据）。Ethereum 的状态可以看作是一个大账本，账本的第一列是名字，第二列是余额，第三列是合约数据。\\n\\n2、Ethereum 的历史由交易构成，交易内部的主要结构是：\\n\\nto - 另一个账户，代表交易的发送对象\\n\\nvalue - 交易携带的 ether 数量\\n\\ndata - 交易携带的任意信息\\n\\n交易更改状态的方法是，EVM 找到交易发送的目标账户：\\n\\n1\\\\.根据交易的 value 计算目标账户的新余额； \\n 2.将交易携带的 data 作为参数传递给目标账户的智能合约，运行智能合约的逻辑，在运行中可能会修改任意账户的内部状态生成新的状态； \\n 3.构造新的叶子存放新的状态，更新状态 Merkle 树。\\n\\n## zkRollup 的基本原理\\n\\nzkRollup 的本质是将链上的用户状态（比如账户余额 、nonce）压缩存储在一棵 Merkle 树中，并将用户状态的变更转移到链下来，同时通过 zkSNARK 的证明来保证该链下用户状态变更过程的正确性。在链上直接处理用户状态的变更成本是比较高的，但是仅仅利用链上的智能合约来验证一个零知识证明的 PROOF 是否正确，成本是相对低很多的。另外必要的转账信息也会被和证明一起提交到合约，方便用户查账。 \\n\\n \\n \",\"timestamp\":1640946058,\"title\":\"zkRollup 原理\"},\"digest\":\"4ixlZwdU05vEV6bRvEv4wCD_lxJzcFHq16zT6ryofzI\",\"authorship\":{\"contributor\":\"0xd05cFA28Eaf8B4eaFD8Cd86d33c6CeD1a1875417\",\"signingKey\":\"{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"KWjtaKwd78DDJrW8n6n5qQxTE9yk6mJXk4es_LvcYgc\\\",\\\"y\\\":\\\"G2NvayJZiTe2Uf64WNGgO06gDiPcjJExpdNPHKCDkus\\\"}\",\"signature\":\"F5wS2mYYSe0t1kURbVyiYszXBxUklwaHHSFhh059kr2OOo2jxUI4cf2gKy2uZ60liVhR9_5YcRN3UZ2wIPS4dg\",\"signingKeySignature\":\"0x37986d551641971cdf6ada5c4365b09fa1f1c9565275e4a2e69a6dfcc1435d3a3e15e6f1cbc1bd770fba430d41423a94c25d58507bcf912632c134b280faffdc1b\",\"signingKeyMessage\":\"I authorize publishing on mirror.xyz from this device using:\\n{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"KWjtaKwd78DDJrW8n6n5qQxTE9yk6mJXk4es_LvcYgc\\\",\\\"y\\\":\\\"G2NvayJZiTe2Uf64WNGgO06gDiPcjJExpdNPHKCDkus\\\"}\",\"algorithm\":{\"name\":\"ECDSA\",\"hash\":\"SHA-256\"}},\"nft\":{},\"version\":\"12-21-2020\",\"originalDigest\":\"I7kuEKu4gaUkiU-mses8qxcUkzMKwdzLR7mlexEfCpw\"}"