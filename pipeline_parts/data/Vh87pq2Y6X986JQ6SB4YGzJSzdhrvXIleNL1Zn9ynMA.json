"{\"content\":{\"body\":\"本文首次发布于2020-11-21，微信公众号IOSGVC\\n\\n![特别致谢 DODO 与 Longhash ，感谢提供宝贵建议！](https://images.mirror-media.xyz/publication-images/zZH4v8tpCuCbsy8Y7dBPX.png?height=608&width=1080)\\n\\n### 引 言\\n\\n本文我们将主要研究 AMM 协议中的流动性提供者（LP），尤其是在后流动性挖矿时代，作为一个LP 可能面对的潜在损失。Uniswap v2 大部分的TVL(约23亿美金)集中在四个为流动性挖矿搭建的资金池中，这些池在整个平台上占比很大。目前 Uniswap 的 LP 不太关心损失，因为他们得到了有价值的 token 和不可小觑的交易费用的补偿。但是随着挖矿停止，作为 LP 的潜在损失将成为大家更关注的问题。\\n\\n### 后流动性挖矿时代的选择 - AMM？\\n\\n\\n流动性挖矿已被证明是冷启动协议的有效激励机制，近期，我们注意到一个在 DeFi 并不漫长的历史上最为疯狂的流动性挖矿事件之一：Uniswap 在几个成功的分叉(如Sushiswap)之后，推出了自己的治理token。每个曾经调用Uniswap v1 或 v2 合约的地址都有资格获得400个UNI，这其中还包括超过12,000 个已提交失败转账的地址。\\n\\n此外，Uniswap 的流动性挖矿已在11月17日停止，将UNI token分配给四个池：USDC/ETH、ETH/USDT、DAI/ETH 和 WBTC/ETH。社区给出了极为热情的反应，TVL（Total Value Locked，总锁仓价值）被**推至 30 亿美金！**\\n\\n*Uniswap v2的历史TVL* \\n\\n![](https://images.mirror-media.xyz/publication-images/gcn5NWxmrxg-7-R1FYULh.png?height=327&width=748)\\n\\n**基于 UNI token 挖矿的炒作，再加上 Uniswap 被大众认为是 DeFi 生态系统支柱的印象**，共吸引了投资人数十亿美元的资金。有了巨额资金量的助攻，Uniswap 提供了在大额交易中最具竞争力的价格。**例如，如果你出售1,000 个ETH ，Uniswap 会是提供最优价格的交易所之一。**\\n\\n另一方面，新的自动做市商(AMM)解决方案正在进一步推动这一领域的发展。值得一提的是在 Uniswap，ETH/USDC 流动性超过5.6亿美元。然而对于同一交易组合，拥有约860 万美元流动性的 DODO ，却可以提供与 Uniswap 一样有竞争力的价格。例如，如果你用1,000 ETH换USDT，COFIX 会提供和 Uniswap 类似的价格，尽管流动性比 Uniswap 小好几倍。 \\n\\n![ 资料来源：DeBank](https://images.mirror-media.xyz/publication-images/fhnRsHcTJv4eUlF_Wilnm.png?height=793&width=1080)\\n\\n由上可以看出，与 Uniswap v2 相比，新的 AMM 模型的资本效率更高。Uniswap v2 若要保持竞争力，它必须保持相对于竞争对手更高的资本金。然而，一旦流动资金挖矿停止，Uniswap v2 还能继续保持现状吗？社区是否会在未来作出抉择？\\n\\n![Uniswap v2、COFIX 及 DODO 概览](https://images.mirror-media.xyz/publication-images/yazYy-RHhaMn3vP2o-s0N.png?height=488&width=1080)\\n\\n### 对 AMM 流动性提供者的无常损失的定义框架\\n\\nUniswap 的LP 究竟遭受了什么样的损失？用来描述这类损失的广泛使用的术语是：无常损失。它是“无常的”，因为理论上它将消失(不会经常发生)，以防提供的 token之间的相对价格恢复。无常损失通常是指因提供流动资金而损失的价值——假设用户在池外持有 token与将这些 token质押到池中的实际价值的区别。\\n\\n更详细地说，价格发现往往发生在外部市场，而Uniswap 依靠套利将 AMM 价格与市场价格相收敛。然而，套利利润是以流动性提供者的利益为代价的，除非特定资产对的外部价格返回到与LP 进入池时相同的比率，否则他将无法从这一损失中恢复过来。\\n\\n**例 1**\\n假设初始余额为10 XYT和1,000 USDC的XYT/USDC 对(价格1XYT=100 USDC)。同时，假设个人投资者持有10 XYT和1,000 USDC的钱包。\\n\\n**如果XYT市场价格飙升到 110 USDC，会发生什么？**\\n\\n该池将提供一个套利机会，因为交易员可以从池中提取被低估的XYT，直到价格与市场价格趋同。具体来说，交易员将从池中提取大约0.47 XYT，从而使每个XYT token的价格达到110 USDC。请注意，将价格移动到特定水平所需的金额是由池使用的公式(曲线)决定的。池中的新余额约为1,048.81 USDC和9.53 XYT token，考虑到新价格XYT=110 USDC，总价值约为2,097 美元。另一方面，在他/她的钱包中持有10 XYT和1,000 USDC的个人投资者，其投资组合价值将等于2,100 美元，这意味着无常的损失约为3 美元。\\n\\nXYT/USDC-假设池 \\n\\n![](https://images.mirror-media.xyz/publication-images/lO5iJC_csZz2HRS4lWiy1.png?height=454&width=752)\\n\\n> 无常损失简介： \\n>\\n> Ø 定义：被动持有token与向池提供流动性之间的差值 \\n>\\n> Ø 原因：套利调整资金池币价\\n\\nDODO和COFIX代表了一种新型AMM，它不依赖套利调整资产池中的资产比率，而是直接从预言机那里获取价格。为了保持一致，让我们看如果将上面的示例放在DODO/COFIX会发生什么。\\n\\n**例 2**\\n假设XYT/USDC 一对初始余额为10 XYT和1,000 USDC(价格1 XYT=100 USDC)。同时，假设个人投资者持有10 XYT和1,000 USDC的钱包。\\n\\n如果XYT市场价格飙升到 110 USDC，会发生什么？\\n\\n资金池不会提供套利机会，因为预言机会调整价格，LP的收支平衡不会因为有外部价格变动而改变。token持有者对于向池提供流动资金和仅仅在钱包中持有token之间的偏好是无差的(忽略交易费用)。\\n\\n因此，新的AMM模型不容易出现无常损失，但这并不意味着我们为新的AMM模型提供流动性没有损失。\\n\\n### 新型AMM模型的损耗特性-COFIX示例\\n\\n**例 3**\\n为了举例说明，假设XYT token值100 USDC的另一个例子。由于COFIX不依赖于池中 token的比率来确定价格，因此让我们进一步假设 token余额等于10 XYT和500 USDC，并且假定资金池价值为1,500美元。\\n如果Alice多存5 XYT，池价值将跃升到2,000美元，她将收到25%的所有权。既然Alice是资金池拥有者，由于COFIX机制的特殊性她需要承担与池中两个 token相关的风险。\\n\\n再次假设XYT token价格上涨至110 USDC，池价值将变成：\\n15 XYT*110 USDC+500 USDC=2,150美元\\nAlice拥有资金池的25%，现在拥有：\\n0\\\\.25*2,150美元=537.5美元\\n然而，如果她有一个单一token敞口，她就可以用550美元退出资金池。另一方面，如果XYT token价格暴跌，她将有一定的保护，因为它暴露在XYT和USDC之间的混合池中，而不仅仅是XYT token。\\n\\n**例 4**\\n此外，COFIX机制的一个特点是没有联合曲线(bonding curve)，而且大额交易不会受到惩罚。因此，在交易商在价格上涨之前完全耗尽XYT供应的情况下极端情况可能发生。再次假设初始价格XYT=100USDC，以及希望获得XYT token敞口的特定交易员Bob。Bob可以用1,500美元购买所有的XYT token，将池留给0XYT和2,000 USDC。之后，如果XYT的价格跃升到110 USDC，Alice将对这一上涨的风险敞口为零。\\nCOFIX风险摘要：\\nØ COFIX确实解决了Uniswap无常损耗问题\\nØ 然而，在COFIX上提供流动性的风险暴露在资金池中，而不是单一的 token。\\nØ 类似的，资金池可以从其中一个 token的上涨中完全耗尽，因为COFIX不区分大额交易(即没有联合曲线)。\\n\\n### 新型AMM模型的损耗特性-DODO示例\\n\\n\\nDODO LP不需要担心上述风险，因为DODO允许单个 token敞口，而不是池所有权。\\n\\n但是，需要注意的是，由于交易活动的数量和频率，在任何时间点的token数量可能与最初存放到池中的 token数量不同。\\n\\n为了再平衡资金池，DODO的机制激励交易者将通过将价格提升至超过市场价，来向资金池卖出供给不够的token。\\n\\n如WBTC/USDC池示例所示，该机制能很好地为池的两边的流动性提供者保留本金，并允许wbtc或USDC LP被动地赚取市场利润。\\n\\nWBTC/USDC池，LP所有权 \\n\\n![ 资料来源：https://DODO-pool-tracker.vercel.app/](https://images.mirror-media.xyz/publication-images/4EqySFb7RTFQ1QtGs0d6m.png?height=160&width=622)\\n\\n然而，看看YFI/USDC池就会发现，并不是所有事情都是完美的。理论上，如果资金池的一边低于1，另一边应该在1以上。YFI/USDC池的两边都大大低于1，这意味着两个池的流动性提供者都遭受了损失。\\n\\nYFI/USDC池，LP所有权 \\n\\n![资料来源：https://DODO-pool-tracker.vercel.app/](https://images.mirror-media.xyz/publication-images/K_ao4zXOsbO7gSccjpRnL.png?height=241&width=956)\\n\\n造成这些损失的主要原因是DODO无法及时重新平衡池中供不应求的部分。为了让DODO的机制像预期的那样运作，对DODO提供的激励(即快速再平衡)的迅速反应是至关重要的，尤其是价格波动剧烈的代币。因为token失衡的时间越长，市场价格发生重大变化的机会就越大。如下文所示，市场价格在这些时期的变化可能损害LP价值。 \\n\\n**例 5** \\n\\n再次假设有10 XYT和500 USDC在资金池中，1 XYT值为100 USDC。如果XYT token目前的余额降至9 XYT，DODO的目标是将XYT的供应再平衡到10，这样做的方法是将XYT的价格提高到高于市场价格的水平，以鼓励交易员将XYT token卖回池中。然而，如果XYT在进行再平衡之前升值到110美元，如果不从USDC LP中提取价值，就不可能将XYT的初始供应量提高到10美元。\\n\\n1. 初始余额：10 XYT & 500 USDC\\n2. 第一次交易后的余额：9 XYT & 600 USDC\\n   XYT的价格在重新平衡之前跃升到110美元。此时，DODO没有足够的资源来重新平衡池的XYT端，因此，只有牺牲池的usdc侧，才有可能将XYT的总量增加到10。\\n3. 假设交易者携带1 XYT到池将导致一个新的余额10 XYT&488 USDC；在这种情况下， USDC LP将累积丢失\\\\~12 USDC。(简化计算)\\n\\n而通常发生的情况是，再平衡发生在价格升值之前。这将使池的两边接近10 XYT和500 USDC的初始余额。另一方面，在重新平衡之前，XYT价格下跌将为上述场景中的LP带来利润，因为DODO将能够在花费不足100 USDC的情况下恢复XYT侧的池，从而产生10 XYT和 > 500 USDC的余额。\\n\\n当池中某个token 供应不足时，DODO 的头寸实质上是该token 中的空头头寸，因为它会随着价格的上涨而造成损失，而随着价格的贬值而产生收益。\\n\\n**例 6**\\n此外,在以下情况下，XYT LP可能会遭受损失：\\n\\n1. 初始余额：10 XYT & 500 USDC\\n2. 第一次交易后的余额：11 XYT & 400 USDC\\n   如前所述，在池中有一个供应不足的USDC侧类似于在USDC中有一个空头位置。因此，XYT的价格下降到90 USDC将意味着相对较强的USDC和同时损失的资金池。\\n   XYT=90 美元，DODO没有足够的资源来重新平衡池的USDC侧，因此，只有牺牲池的XYT侧，才有可能将USDC的总数达到500。\\n3. 假设交易者将100USDC带到池中，将产生新的余额。：\\\\~9.86 XYT 和 500 USDC，LP损失为\\\\~0.14 XYT(简化计算)\\n\\n同理，再平衡之前，XYT的价格上涨会在上述情况下为LP带来利润，因为它意味着USDC的相对疲软。\\n\\n如上文示例所示，有效的再平衡对于保护LP的值和最小化风险至关重要。否则，DODO本身就是在池的一侧有空头头寸，并且基于市场波动可能会产生利润/亏损。相比之下，当池处于平衡状态时，DODO是市场中立的。\\n\\n回到YFI/USDC池，造成损失的原因是无法维持市场中性的头寸，因此对YFI token的大幅波动的风险敞口过大。YFI/USDC对损失的另一个潜在原因是易受预言机超前交易的漏洞影响。由于DODO依赖Chainlink 喂价，交易员可以观察到，特定 token的在预言机价格将在下一个块中上涨，并从池中提取大量token，但在更新立即出售。这一行为将给交易者带来套利，给DODO LP带来损失。 \\n\\n**例 7**\\n\\n1. 初步余额：10 XYT & 500 USDC\\n   XYT的价格将在下一个区块上涨到110 美元。\\n2. 交易员在预言机超前交易，从池中获取1 XYT(为了简单)。\\n3. 新余额：9 XYT & 600 USDC, 价格正式更新\\n   此时，DODO没有足够的资源来重新平衡池的XYT端，因此，只有牺牲池的USDC侧，才有可能将XYT的总量增加到10。\\n4. 交易员在更新锁定后退出头寸\\\\~12 美元利润，新余额：10 XYT & \\\\~488 USDC, USDC LP 将失去 \\\\~12 USDC\\n\\n虽然示例5和示例7 的最终结果是相同的，后者对LP 的危害要大得多。示例5 中的交易者很可能被归类为随机交易流，没有能力预测市场方向。因此，作为这类交易商的交易对手是可以接受的。相反，示例7 中的交易员是信息交易者(套利者)，肯定会给流动性提供者造成损失。YFI/USDC池两侧明显低于1，可能意味着原因是信息交易者(套利者)，而非随机交易流。\\n\\n尽管如此，DODO 确实提供单一的token 敞口，LP 必须注意到另一个token 池的特性。。例如，从理论上讲，由于单一token 敞口，如果您是USDC LP，您将不关心池中的其他 token 是WBTC 还是YFI。然而，在实践中，这种差异是巨大的。池中的其他 token越不稳定，风险敞口就越大。\\n\\n\\n**DODO风险摘要：**\\nØ DODO解决了Uniswap 的无常损失特性，并且它不容易受到COFIX 一样的损失，因为它提供了单一的token敞口。\\nØ 然而，当DODO不能有效地重新平衡 token供应时，LP就会间接地暴露在池的另一边。在这种情况下，DODO LP可能会根据市场价格变动赚取利润/蒙受损失。\\nØ 最后，DODO LP肯定会在套利者成功以喂价超前交易的情况下遭受损失。\\n\\n上述COFIX 和DODO LP 的损失从本质上来看就是是无常的，因为如果价格变动有利于做市商，它们可能消失，甚至不一定存在。但是，我们不能按照前面讨论的定义将它们归类为无常损失，而是可以将它们定义为每个协议特定的的做市风险。\\n\\n下面我们总结了上述每个平台的风险特征。 \\n\\n![](https://images.mirror-media.xyz/publication-images/V3d6aYd4MXPUOZ5kjTWUA.png?height=248&width=1080)\\n\\n### 风险对冲-AMM协议的可持续发展的关键点\\n\\n做市不是一种无风险的活动，无论是使用订单模型还是AMM协议模型。无论怎样，LP都需注意在不利情形下潜在的损失。如果不了解风险，LP就无法准确确定挖矿资金的预期回报率，也无法适当对冲其头寸。\\n\\n在套期保值方面，去中心化期权市场的增长可以为AMM LP提供更多的必要工具，以对冲其风险。例如，AMMS可以通过特定的 token导数或高度相关资产的导数自动抵消头寸。在例5中，第二步交易之后(在价格上涨之前)，DODO LP可能会自动在XYT token上做一个看涨期权，以抵消风险敞口。类似地，COFIX LP可能希望在例4中购买XYT token上的看涨期权，以获得 token的正向敞口。另一方面，套期保值可能代价高昂，因此套期保值可能不必要地挤压利润率。\\n\\n这里要考虑的因素包括风险偏好，近期交易规模，交易对手和标的资产的特性。显然，在DODO 示例场景中，池中的 token消耗越多，就越需要对冲 token上行的风险。同样，交易流是否随机或信息量足够大也会影响套期保值的需求。目前，AMM还无法对交易流进行分类，但是将来引入机器学习来分析来自特定地址的历史订单流可能会使AMM获得这些信息。最后，如果标的资产相对稳定，则风险较小，需要抵消定向头寸的需求也更小。\\n\\n\\\\*\\\\*COFIX是第一家为LP提供套期保值选择的公司：<https://github.com/Computable-Finance/CoFiX-hedger>\\n\\n### 结 语\\n\\n设计简单、易于理解是Uniswap 的关键优势，也因此吸引了大量的LP 和资本。而另一方面，新兴AMM 解决方案由于试图提高资本效率，不可避免地变得越来越复杂。尽管如此，在这些AMM 解决方���中，我们相信任何做市活动都会带来潜在的损失。LP必须注意这些损失，并根据自身风险偏好来分析和对冲他们的风险。\\n\\n在这样一个快节奏的领域中，创新总是先行一步。随着流动性挖矿激励完成其引导协议和吸引早期用户的初始使命后，真正的游戏才刚刚开始。对于AMM 协议，我们需要更多专业的分析和对冲框架和工具，以推动其可持续性的广泛应用。\\n\\n![Note：DODO、1inch.exchange、Kyber Network 是 IOSG 投资组合成员。](https://images.mirror-media.xyz/publication-images/2qmgDDNxdhBaq1qpxTdxz.png?height=415&width=638)\\n\\n\\n英文原文链接（Medium）：\\n<https://medium.com/iosg-ventures/the-day-after-tomorrow-for-amm-protocols-potential-losses-to-beware-of-in-the-post-liquidity-e58353d3833d> \\n\\n![](https://images.mirror-media.xyz/publication-images/ihSAAv_dulGWOrHHBrm-2.jpg?height=888&width=1890)\\n\\n\",\"timestamp\":1642389649,\"title\":\"IOSG 深度研究 | 后流动性挖矿时代AMM协议的潜在风险损失\"},\"digest\":\"QIJ9rw9p9QSNp--cq_IN1R63kXxg0nXh4i_h7NR_L6I\",\"authorship\":{\"contributor\":\"0x5Eba828AB4999825D8416D7EAd9563b64FD90276\",\"signingKey\":\"{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"vfbDo9LoM4JsLXJReImBKPScsREbsknZ3DBvIkTPuY8\\\",\\\"y\\\":\\\"VsJvWOFcjNa6PFy-H4RKKRIzzBkzrn2OqxDRrhfID0g\\\"}\",\"signature\":\"wNXr71QvCzwkCfnn1NulkZWrB0FxOO0NogSnB1t50vHQeMYlh3ApgCPOOsDg4XDO5O_0MuKB5ZT3pX--rGGm_A\",\"signingKeySignature\":\"0x388807b7638e5119d43755be8f4323b255625a124080848b9edfcc905bc1d41e5e2d28df1d6eafbcbf89aa06acd81e7044dc7689851d7bc4f647207014893f8a1b\",\"signingKeyMessage\":\"I authorize publishing on mirror.xyz from this device using:\\n{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"vfbDo9LoM4JsLXJReImBKPScsREbsknZ3DBvIkTPuY8\\\",\\\"y\\\":\\\"VsJvWOFcjNa6PFy-H4RKKRIzzBkzrn2OqxDRrhfID0g\\\"}\",\"algorithm\":{\"name\":\"ECDSA\",\"hash\":\"SHA-256\"}},\"nft\":{},\"version\":\"12-21-2020\",\"originalDigest\":\"QIJ9rw9p9QSNp--cq_IN1R63kXxg0nXh4i_h7NR_L6I\"}"