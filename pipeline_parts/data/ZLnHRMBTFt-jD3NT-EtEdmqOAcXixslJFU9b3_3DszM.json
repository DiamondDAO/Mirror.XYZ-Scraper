"{\"content\":{\"body\":\"今天我在heco上的套利合约被人黑了，损失大概是53000美金。\\n\\n合约的漏洞大致是：\\n\\n* 合约中有approve 给router的操作\\n* router是输入传的\\n* 黑客传入自己的合约作为router，但是实际在他的router.swap的逻辑中不做任何操作，所以approve给他的金额没有消费掉\\n* 给我转小额，通过我的余额检查\\n* 从我的逻辑中退出后，因为approve给他的限额没有消费掉，现在可以从我的合约里直接转钱走了\\n\\n其实，合约的检查可以更仔细，但是之前考虑到合约不对外且不开源，为了方便，没有加一下验证。这次是真的被迫涨记性了\\n\\n通过这次的被盗，至少有一下几点心得：\\n\\n* 合约不开源是可以反编译的，solidity反编译的可读性相对较高\\n* 套利合约，是容易被人盯上的\\n* sender和tx.origin的检查不能少\\n* 逻辑结束的时候，除了余额检查，应该取消所有approve\\n\\n哎\",\"timestamp\":1636167001,\"title\":\"我被黑了\"},\"digest\":\"x-vqeYpOxVZqMneN8-Dkv8O8CFBFRuoboU1T1oCWT90\",\"authorship\":{\"contributor\":\"0xFC143f933BAdBEfe4E769047745cc23E02DE0E90\",\"signingKey\":\"{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"XbOYPvWbyN9z7XEu0Xzg9BH70G8WOI9HB26ikr7Rpks\\\",\\\"y\\\":\\\"7eg2mKpAcOZqd0_fSY6qzUTyaanSRAaulUbZce5cBuE\\\"}\",\"signature\":\"bHQWKHV-I-jOKOf7eFlckaCx9T1uH9jPSufp8JnQxy7_wxAWVL0Z3Sl6WkvOCIa9qYCA-3gzx5GIMtD6LqiZ-A\",\"signingKeySignature\":\"0x200e583415747639703f14a873ae3bec0d43979481304eaaf50ce79fca7f7102649a5a5d7eaf5ef7101cdfd07c81236c749b6b831cfc93291fb8dfe838ee51351c\",\"signingKeyMessage\":\"I authorize publishing on mirror.xyz from this device using:\\n{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"XbOYPvWbyN9z7XEu0Xzg9BH70G8WOI9HB26ikr7Rpks\\\",\\\"y\\\":\\\"7eg2mKpAcOZqd0_fSY6qzUTyaanSRAaulUbZce5cBuE\\\"}\",\"algorithm\":{\"name\":\"ECDSA\",\"hash\":\"SHA-256\"}},\"nft\":{},\"version\":\"12-21-2020\",\"originalDigest\":\"x-vqeYpOxVZqMneN8-Dkv8O8CFBFRuoboU1T1oCWT90\"}"