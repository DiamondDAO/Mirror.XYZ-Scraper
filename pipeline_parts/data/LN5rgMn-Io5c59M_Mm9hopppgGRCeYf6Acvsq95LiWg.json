"{\"content\":{\"body\":\"一、Protobuf序列化原理简介\\n1、序列化\\n序列化是将数据结构或对象转换成二进制字节流的过程。\\nProtobuf对于不同的字段类型采用不同的编码方式和数据存储方式对消息字段进行序列化，以确保得到高效紧凑的数据压缩。\\nProtobuf序列化过程如下：\\n（1）判断每个字段是否有设置值，有值才进行编码。\\n（2）根据字段标识号与数据类型将字段值通过不同的编码方式进行编码。\\n（3）将编码后的数据块按照字段类型采用不同的数据存储方式封装成二进制数据流。\\n\\n2、反序列化\\n反序列化是将在序列化过程中所生成的二进制字节流转换成数据结构或者对象的过程。\\nProtobuf反序列化过程如下：\\n（1）调用消息类的parseFrom(input)解析从输入流读入的二进制字节数据流。\\n（2）将解析出来的数据按照指定的格式读取到Java、C++、Phyton对应的结构类型中。\\n\\n二、Protobuf编码方式\\n1、Varint编码\\nVarint编码是一种变长的编码方式，编码原理是用字节表示数字，值越小的数字，使用越少的字节数表示。因此，可以通过减少表示数字的字节数进行数据压缩。\\n对int32类型的数字，一般需要4个字节表示。如果采用Varint编码，对于很小的int32类型数字，则可以用1个字节来表示；虽然大的数字会需要5个字节来表示，但大多数情况下，消息都不会有很大的数字，所以采用Varint编码方式总是可以用更少的字节数来表示数字。\\nVarint编码后每个字节的最高位都有特殊含义：\\nA、如果是1，表示后续的字节也是数字的一部分。\\nB、如果是0，表示本字节是最后一个字节，且剩余7位都用来表示数字。\\n当使用Varint解码时时，只要读取到最高位为0的字节时，表示本字节是一个值经Varint编码后得到的字节流的最后一个字节。\\n在计算机内，负数一般会被表示为很大的整数 ，因为计算机定义负数的符号位为数字的最高位，如果采用Varint编码方式表示一个负数，那么一定需要5个byte（因为负数的最高位是1，会被当做很大的整数处理）\\nProtobuf定义了sint32 / sint64类型表示负数，通过先采用Zigzag编码（将有符号数转换成无符号数），再采用Varint编码，从而用于减少编码后的字节数。\\n对于一个int32类型的值300的Varint编码如下：\\n300的二进制编码为：100101100（256+32+8+4）\\n从字节流末尾取出7bit并在最高位增加1构成一个字节：\\\\[1\\\\]010 1100\\n从字节流末尾取出7bit并在最高位增加1构成一个字节，如果是最后一个字节增加0：\\\\[0\\\\]0000010\\n两字节为：\\\\[0\\\\]0000010 \\\\[1\\\\]010 1100\\n转换为小端模式：10101100 00000010\\n编码结果：1010 1100 0000 0010\\n\\n## 2、Zigzag编码\\nZigazg编码是一种变长的编码方式，其编码原理是使用无符号数来表示有符号数字，使得绝对值小的数字都可以采用较少字节来表示，特别对表示负数的数据能更好地进行数据压缩。\\nZigzag编码对Varint编码在表示负数时不足的补充，从而更好的帮助Protobuf进行数据的压缩。因此，如果提前预知字段值是可能取负数的时候，需要采用sint32/sint64数据类型。 \",\"timestamp\":1637677549,\"title\":\"Protobuf序列化原理解析\"},\"digest\":\"YvL2F4XVHrzASTICMCY2FJr7keV5snSn1BTfb6YvI70\",\"authorship\":{\"contributor\":\"0x42B124F63475D8b3792c150e4d13D0F4E4630a8F\",\"signingKey\":\"{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"2UMd86izd95p5cWS5O3xWIz8oekY8J7gV7H5vIi3aws\\\",\\\"y\\\":\\\"kaq4cZeCdrJSCpiUrLBsZqGOchFWVMIflgXk8fuo7Rk\\\"}\",\"signature\":\"TZMpgZ6f7btxo17lAf16hs6BXUts1Po_-v-R71USO1LUl6zvC0E-YbISiwFrApUs06nA0N7OuAorf_-FUByl6g\",\"signingKeySignature\":\"0xb949e7518fd3bff4a64305b1aa9c26a93912786258bb044b56c6eab03269b61468fd3155606217b4be7b60199cd6be9592545680fdcee4575deebff026c1f0f91c\",\"signingKeyMessage\":\"I authorize publishing on mirror.xyz from this device using:\\n{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"2UMd86izd95p5cWS5O3xWIz8oekY8J7gV7H5vIi3aws\\\",\\\"y\\\":\\\"kaq4cZeCdrJSCpiUrLBsZqGOchFWVMIflgXk8fuo7Rk\\\"}\",\"algorithm\":{\"name\":\"ECDSA\",\"hash\":\"SHA-256\"}},\"nft\":{},\"version\":\"12-21-2020\",\"originalDigest\":\"YvL2F4XVHrzASTICMCY2FJr7keV5snSn1BTfb6YvI70\"}"