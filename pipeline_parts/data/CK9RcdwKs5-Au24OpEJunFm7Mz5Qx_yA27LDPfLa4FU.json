"{\"content\":{\"body\":\"certbot可以配合nginx，自动化配置和更新SSL证书\\n\\n配置环境: Ubuntu 20.04 2核4G内存安装包版本：gitlab-ce_13.8.4 arm64文件系统： linux ext4\\n\\n# 目录\\n\\n* [安装前准备](#%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87)\\n* [下载安装](#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85)\\n* [配置nginx](#%E9%85%8D%E7%BD%AEnginx)\\n* [用certbot生成证书](#%E7%94%A8certbot%E7%94%9F%E6%88%90%E8%AF%81%E4%B9%A6)\\n  * [可能碰到的错误](#%E5%8F%AF%E8%83%BD%E7%A2%B0%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF)\\n* [检查新的nginx配置](#%E6%A3%80%E6%9F%A5%E6%96%B0%E7%9A%84nginx%E9%85%8D%E7%BD%AE)\\n* [参考资料](#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99)\\n* [windows版使用](#windows%E7%89%88%E4%BD%BF%E7%94%A8)\\n\\n## 安装前准备\\n\\n确认本机已经安装nginx，并且在编译时添加了ssl模块 `--with-http_ssl_module`\\n已经有一个域名，并且将DNS解析到了本机\\n防火墙打开希望配置的http和https端口，这里以80和443为例\\n\\n## 下载安装\\n\\n```\\napt-get update\\nsudo apt-get install -y certbot python3-certbot-nginx\\n```\\n\\n## 配置nginx\\n\\n自己先配置一个http的版本即可，例如\\n\\n```\\nserver {\\n    listen 80 default_server;\\n    root /var/www/html;\\n    server_name example.com www.example.com;\\n}\\n```\\n\\n重新启动nginx`nginx -t && nginx -s reload`测试访问`http://example.com`\\n\\n## 用certbot生成证书\\n\\n`sudo certbot --nginx -d example.com -d www.example.com`\\n\\n## 可能碰到的错误\\n\\n1. Could not find a usable 'nginx' binary\\n   找不到nginx，是因为没有将nginx放到环境变量中，设置nginx软连接\\n\\n   ```\\n   ln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx\\n   ln -b /usr/local/nginx/conf/nginx.conf /etc/nginx/nginx.conf\\n   ```\\n2. Nginx build is missing SSL module (--with-http_ssl_module).\\n\\n   nginx缺少模块，重新编译nginx\\n\\n   ```\\n   cd /opt/software/nginx-1.18.0\\n   ./configure --with-http_ssl_module\\n   make && make install\\n   ```\\n\\n得到输出\\n\\n```\\nCongratulations! You have successfully enabled https://example.com and https://www.example.com \\n\\n-------------------------------------------------------------------------------------\\nIMPORTANT NOTES: \\n\\nCongratulations! Your certificate and chain have been saved at: \\n/etc/letsencrypt/live/example.com/fullchain.pem \\nYour key file has been saved at: \\n/etc/letsencrypt/live/example.com//privkey.pem\\nYour cert will expire on 2017-12-12.\\n```\\n\\n测试访问\\n`https://example.com`\\n\\n## 检查新的nginx配置\\n\\n看到的应该类似这样\\n\\n```\\nserver {\\n    listen 80 default_server;\\n    listen [::]:80 default_server;\\n    root /var/www/html;\\n    server_name  example.com www.example.com;\\n\\n    listen 443 ssl; # managed by Certbot\\n\\n    # RSA certificate\\n    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem; # managed by Certbot\\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem; # managed by Certbot\\n\\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\\n\\n    # Redirect non-https traffic to https\\n    if ($scheme != \\\"https\\\") {\\n        return 301 https://$host$request_uri;\\n    } # managed by Certbot\\n}\\n```\\n\\n## 参考资料\\n\\n[将Let's Encrypt与NGINX一起使用](https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/)\\n\\n[nginx免费https证书（certbot）](https://my.oschina.net/blueskyer/blog/3220726)\\n\\n## windows版使用\\n\\n按照这两个文档配置即可\\n\\n[官方文档](https://certbot.eff.org/lets-encrypt/windows-nginx)\\n\\n[域名验证方式](https://letsencrypt.org/zh-cn/docs/challenge-types/)\\n\\n运行\\n\\n```\\ncertbot certonly --webroot\\n```\",\"timestamp\":1636185425,\"title\":\"certbot安装使用\"},\"digest\":\"1tRylbg8UzfY0z8Qi4WzkAjySs9-7AQuL7jXqYRHp-8\",\"authorship\":{\"contributor\":\"0x250A1D52A41E693101edED658F67943725CDDB7e\",\"signingKey\":\"{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"F2dAzWtnZEIcPM6tMEUN3jrpaOvJjuhtDfgpBakAaA0\\\",\\\"y\\\":\\\"zRTgZU_WSNenW-E3Y7bsJNgVsSN5FTsbc2BjUFm_rfU\\\"}\",\"signature\":\"BxEjSgs_f5fAklUEPdBKQLxT14kGBZaQhPRauGZPe_WOCVrJqTrI8ENVyHLo9lQlupSC-bG-K2-ex7inNMKj2g\",\"signingKeySignature\":\"0xcb762b94ab41ac5ab86f45339e26205b08439ae3050208bd39cec7e619b700b058ab60f99beee712470e2b924cb6bfa03e89ea88e9a9b515b356b8c101f566021b\",\"signingKeyMessage\":\"I authorize publishing on mirror.xyz from this device using:\\n{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"F2dAzWtnZEIcPM6tMEUN3jrpaOvJjuhtDfgpBakAaA0\\\",\\\"y\\\":\\\"zRTgZU_WSNenW-E3Y7bsJNgVsSN5FTsbc2BjUFm_rfU\\\"}\",\"algorithm\":{\"name\":\"ECDSA\",\"hash\":\"SHA-256\"}},\"nft\":{},\"version\":\"12-21-2020\",\"originalDigest\":\"1tRylbg8UzfY0z8Qi4WzkAjySs9-7AQuL7jXqYRHp-8\"}"