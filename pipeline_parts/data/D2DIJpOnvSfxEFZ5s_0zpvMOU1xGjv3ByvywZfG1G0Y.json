"{\"content\":{\"body\":\"### 背景信息介绍:\\n\\n#### 代码请参考:\\n\\n[https://github.com/HugePages/troubles](https://github.com/HugePages/troubles)\\n\\n代码时序图:\\n\\n![主体代码时序图](https://images.mirror-media.xyz/publication-images/nShgCoEh3oaq8hBlikHoK.png?height=544&width=1312)\\n\\n### 测试场景 1 : 执行不同长度的 sql 语句,当 sql 太长,导致事务不回滚\\n\\n#### 发起请求 http://127.0.0.1:8080/demo/insert-rollback?type=1&exception=1\\n\\n[http://127.0.0.1:8080/demo/insert-rollback?type=1&exception=1](http://127.0.0.1:8080/demo/insert-rollback?type=1&exception=1)\\n\\n查看 Wireshark 对应 mysql 协议的监控如图:\\n\\n![sql 语句执行 insert1 语句(不超过配置项2048长度)](https://images.mirror-media.xyz/publication-images/eLR111o33ASYWTbeEoGZt.png?height=322&width=1237)\\n\\n此时,代码执行符合预期 : 出现异常, spring 的事务管理正常,执行 rollback 操作,数据库没有新数据插入:\\n\\n![查询数据库结果,数量为0](https://images.mirror-media.xyz/publication-images/P-O5JMUiR8sXWTjMcAeLG.png?height=316&width=971)\\n\\n#### 发起请求 http://127.0.0.1:8080/demo/insert-rollback?type=0&exception=1\\n\\n![](https://images.mirror-media.xyz/publication-images/TDhFGOxixV0Hx5OrRXmOV.png?height=410&width=1057)\\n\\n查看Wireshark 对应 mysql 协议的监控如图:\\n\\n![此时的 mysql 协议多了一个请求,Close Statement](https://images.mirror-media.xyz/publication-images/9PyVNscK6txDKpGtnza84.png?height=515&width=1378)\\n\\n通过 debug,事务也是交由 spring 进行管理,也执行了 rollback 操作,但是最终数据还是插入到数据库中:\\n\\n![数据插入成功](https://images.mirror-media.xyz/publication-images/OBxXFhikgBXGPh21Ak3eE.png?height=315&width=945)\\n\\n[https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration](https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration)\\n\\n[https://stackoverflow.com/questions/50234214/transactions-are-not-getting-rollbacked-with-hikaricp](https://stackoverflow.com/questions/50234214/transactions-are-not-getting-rollbacked-with-hikaricp)\\n\\n[https://docstore.mik.ua/orelly/weblinux2/mysql/ch08_02.htm](https://docstore.mik.ua/orelly/weblinux2/mysql/ch08_02.htm)\\n\\n[https://dev.mysql.com/doc/relnotes/connector-j/5.1/en/news-5-1-40.html](https://dev.mysql.com/doc/relnotes/connector-j/5.1/en/news-5-1-40.html)\\n\\n[https://bugs.mysql.com/bug.php?id=75209](https://bugs.mysql.com/bug.php?id=75209)\\n\\n[https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-connp-props-performance-extensions.html](https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-connp-props-performance-extensions.html)\\n\\n[https://blog.csdn.net/qq_42782063/article/details/90671430](https://blog.csdn.net/qq_42782063/article/details/90671430)\\n\\n[https://p6spy.readthedocs.io/en/latest/install.html](https://p6spy.readthedocs.io/en/latest/install.html)\\n\\n[https://cloud.tencent.com/developer/article/1710665](https://cloud.tencent.com/developer/article/1710665)\\n\\n[https://blog.csdn.net/qq_35890572/article/details/107768885](https://blog.csdn.net/qq_35890572/article/details/107768885)\\n\\n[https://blog.csdn.net/yyb_gz/article/details/108428442?spm=1001.2014.3001.5501](https://blog.csdn.net/yyb_gz/article/details/108428442?spm=1001.2014.3001.5501)\\n\\n![](https://images.mirror-media.xyz/publication-images/rdROfh86y2XVEFSZ2RIwc.png?height=1684&width=3816)\\n\\n\",\"timestamp\":1642390348,\"title\":\"为什么spring事务管理,出现异常没回滚\"},\"digest\":\"k8rQ6nTAlrJfLDIpVtAA0soa3HDXTMkJ8ngYO-QhjBI\",\"authorship\":{\"contributor\":\"0xCc754e4239F0aB60c60d9AF4523D1289C3cD2814\",\"signingKey\":\"{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"yTUDgMFby6Qvvzwx7-K3oFnIljDywRpdlc-FA1--ipw\\\",\\\"y\\\":\\\"sLbTwZCw6_coYI-fZTyZdqk8aey95FzCbJyiEu-0LIw\\\"}\",\"signature\":\"G8pqauuy4J8RX_3GsTHgBQHW7uBNYfko4P1aSWUkNTJCMIlqmjKG2KLnokoeZAu4SODdHIZ8Ulb1nAXMgxqUpA\",\"signingKeySignature\":\"0x967c74e394ae54f91c5c13970066263d9eb8d27c84a14e4fd40a93fb28573f9650724a724732fd42c98c283541abf339d96d779f71fd4063bf1f84ee5059222e1b\",\"signingKeyMessage\":\"I authorize publishing on mirror.xyz from this device using:\\n{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"yTUDgMFby6Qvvzwx7-K3oFnIljDywRpdlc-FA1--ipw\\\",\\\"y\\\":\\\"sLbTwZCw6_coYI-fZTyZdqk8aey95FzCbJyiEu-0LIw\\\"}\",\"algorithm\":{\"name\":\"ECDSA\",\"hash\":\"SHA-256\"}},\"nft\":{},\"version\":\"12-21-2020\",\"originalDigest\":\"be-XbKVEBQRfoXJnU6gMu3QYD0Bf2NmeQqkPAh3Wh_k\"}"