"{\"content\":{\"body\":\"**Town Star脚本教程**\\n\\nYoutube：加密大聪明\\n\\n教程：\\n\\n1、谷歌应用商店搜索：Tampermonkey\\n\\n2、添加到快捷任务栏\\n\\n![](https://images.mirror-media.xyz/publication-images/Rdg0DWwFGnrT7fwhzYvik.png?height=357&width=441)\\n\\n3、在town star页面点击Tampermonkey！\\n\\n \\n\\n \\n\\n![](https://images.mirror-media.xyz/publication-images/Q5EpbBt2YppmWwaiIiRbY.png?height=81&width=423)\\n\\n4、添加新脚本\\n\\n \\n\\n \\n\\n![](https://images.mirror-media.xyz/publication-images/_rXRs5mU8bN5jOdAw81hC.png?height=369&width=297)\\n\\n \\n\\n \\n\\n5、删除自带的，复制粘贴下面的代码\\n\\n \\n\\n![](https://images.mirror-media.xyz/publication-images/P51hZT2VjP9WvxqobqnHx.png?height=289&width=402)\\n\\n \\n\\n \\n\\n6、修改代码，修改成你要卖的商品名字\\n\\n \\n\\n \\n\\n![](https://images.mirror-media.xyz/publication-images/itlEX_I--phma8qZl3V31.png?height=397&width=554)\\n\\n \\n\\n7、保存\\n\\n![](https://images.mirror-media.xyz/publication-images/MB4qFhS_QGkfqSXYjP5MK.png?height=397&width=554)\\n\\n \\n\\n8、一定要刷新town star，出现auto-sell active\\n\\n就是成功了。\\n\\n \\n\\n![](https://images.mirror-media.xyz/publication-images/XuE0RUCIPORdHgXfsvLWp.png?height=113&width=423)\\n\\n \\n\\n \\n\\n**自动卖货**\\n\\n \\n // ==UserScript==\\n\\n// @name         Town Star Auto-Sell\\n\\n// @namespace    http://tampermonkey.net/\\n\\n// @version      2.1\\n\\n// @description  Automatically sell crafted items.\\n\\n// @author       Groove\\n\\n// @match        https://townstar.sandbox-games.com/launch/\\n\\n// @grant        none\\n\\n// @run-at       document-start\\n\\n// ==/UserScript==\\n\\n \\n\\n(function() {\\n\\n    'use strict';\\n\\n// keepAmt is the amount that you do not want to sell\\n\\n// sellMin is the minimum amount needed before attempting to sell\\n\\n//    setting a sellMin of 100 will ensure that the item is only sold in batches of 100 (e.g. via Freight Ship)\\n\\n    const craftedItems = \\\\[\\n\\n        {item: 'Salt', keepAmt: 0, sellMin: 10},\\n\\n       \\n\\n    \\\\]\\n\\n \\n\\n    new MutationObserver(function(mutations) {\\n\\n        let airdropcollected = 0;\\n\\n        if(document.getElementsByClassName('hud-jimmy-button')\\\\[0\\\\] && document.getElementsByClassName('hud-jimmy-button')\\\\[0\\\\].style.display != 'none'){\\n\\n            document.getElementsByClassName('hud-jimmy-button')\\\\[0\\\\].click();\\n\\n            document.getElementById('Deliver-Request').getElementsByClassName('yes')\\\\[0\\\\].click();\\n\\n            document.getElementById('Deliver-Request').getElementsByClassName('close-button')\\\\[0\\\\].click();\\n\\n        }\\n\\n        if(document.getElementsByClassName('hud-airdrop-button')\\\\[0\\\\] && document.getElementsByClassName('hud-airdrop-button')\\\\[0\\\\].style.display != 'none'){\\n\\n            if(airdropcollected == 0){\\n\\n                airdropcollected = 1;\\n\\n                document.getElementsByClassName('hud-airdrop-button')\\\\[0\\\\].click();\\n\\n                document.getElementsByClassName('air-drop')\\\\[0\\\\].getElementsByClassName('yes')\\\\[0\\\\].click();\\n\\n            }\\n\\n        }\\n\\n        if (document.getElementById(\\\"playnow-container\\\") && document.getElementById(\\\"playnow-container\\\").style.visibility !== \\\"hidden\\\") {\\n\\n            if(typeof Game == 'undefined' || (Game && Game.gameData == null)) {\\n\\n                window.location.reload();\\n\\n            } else {\\n\\n                document.getElementById(\\\"playButton\\\").click();\\n\\n                console.log(Date.now() + ' ---===ACTIVATING AUTO SELL===---');\\n\\n                ActivateAutoSell();\\n\\n            }\\n\\n        }\\n\\n    }).observe(document, {childList: true, subtree: true});\\n\\n \\n\\n    function GetAvailableTradeObject(capacity) {\\n\\n        return Object.values(Game.town.objectDict).filter(tradeObj => tradeObj.logicType === 'Trade')\\n\\n            .find(tradeObj =>\\n\\n                  Game.unitsData\\\\[tradeObj.objData.UnitType\\\\].Capacity == capacity\\n\\n                  && !Game.town.tradesList.find(activeTrade => activeTrade.source.x == tradeObj.townX && activeTrade.source.z == tradeObj.townZ)\\n\\n                 )\\n\\n    }\\n\\n \\n\\n    function CloseWindows(elements, checkParent) {\\n\\n        for (let i=0, n=elements.length; i < n; i++) {\\n\\n            let el = checkParent ? elements\\\\[i\\\\].closest('.container') : elements\\\\[i\\\\];\\n\\n            let elVis = el.currentStyle ? el.currentStyle.visibility : getComputedStyle(el, null).visibility;\\n\\n            let elDis = el.currentStyle ? el.currentStyle.display : getComputedStyle(el, null).display;\\n\\n            if (!(elVis === 'hidden' || elDis === 'none')) {\\n\\n                el.querySelector('.close-button') && el.querySelector('.close-button').click();\\n\\n            }\\n\\n        }\\n\\n    }\\n\\n \\n\\n    async function WaitForCompletion(selector) {\\n\\n        while (document.querySelector(selector) !== null) {\\n\\n            await new Promise( resolve => requestAnimationFrame(resolve) )\\n\\n        }\\n\\n        return document.querySelector(selector);\\n\\n    }\\n\\n \\n\\n    async function WaitForTradeLoad(targetTradeObj) {\\n\\n        return await new Promise(resolve => {\\n\\n            const waitForUpdate = setInterval(() => {\\n\\n                let tradeUiObj = Game.app.root.findByName('TradeUi').script.trade.townObject;\\n\\n                if (tradeUiObj && tradeUiObj.townX == targetTradeObj.townX && tradeUiObj.townZ == targetTradeObj.townZ && Game.app.root.findByName('TradeUi').script.trade.cityPaths\\\\[0\\\\].gasCost) {\\n\\n                    resolve('Loaded');\\n\\n                    clearInterval(waitForUpdate);\\n\\n                };\\n\\n            }, 500);\\n\\n        });\\n\\n    }\\n\\n \\n\\n    async function WaitForElement(selector) {\\n\\n        while (document.querySelector(selector) === null) {\\n\\n            await new Promise( resolve => requestAnimationFrame(resolve) )\\n\\n        }\\n\\n        await new Promise(resolve => setTimeout(resolve, 1000));\\n\\n        return document.querySelector(selector);\\n\\n    }\\n\\n \\n\\n    async function CheckCrafts() {\\n\\n        let allTradeObjects = Object.values(Game.town.objectDict).filter(tradeObj => tradeObj.logicType === 'Trade');\\n\\n        for (let i=0, n=allTradeObjects.length; i < n; i++) {\\n\\n            if (allTradeObjects\\\\[i\\\\].logicObject.tapToCollectEntity.enabled) {\\n\\n                allTradeObjects\\\\[i\\\\].logicObject.OnTapped();\\n\\n            }\\n\\n        }\\n\\n        if (Game.town.GetStoredCrafts()\\\\['Gasoline'\\\\] >= 1) {\\n\\n            for (let i=0, n=craftedItems.length; i < n; i++) {\\n\\n                if (Game.town.GetStoredCrafts()\\\\[craftedItems\\\\[i\\\\].item\\\\] >= craftedItems\\\\[i\\\\].keepAmt + 10) {\\n\\n                    let targetTradeObj;\\n\\n                    if (Game.town.GetStoredCrafts()\\\\[craftedItems\\\\[i\\\\].item\\\\] >= 100 + craftedItems\\\\[i\\\\].keepAmt) {\\n\\n                        targetTradeObj = GetAvailableTradeObject(100);\\n\\n                    }\\n\\n                    if (!targetTradeObj && Game.town.GetStoredCrafts()\\\\[craftedItems\\\\[i\\\\].item\\\\] >= 50 + craftedItems\\\\[i\\\\].keepAmt && craftedItems\\\\[i\\\\].sellMin <= 50){\\n\\n                        targetTradeObj = GetAvailableTradeObject(50);\\n\\n                    }\\n\\n                    if (!targetTradeObj && Game.town.GetStoredCrafts()\\\\[craftedItems\\\\[i\\\\].item\\\\] >= 10 + craftedItems\\\\[i\\\\].keepAmt && craftedItems\\\\[i\\\\].sellMin <= 10){\\n\\n                        targetTradeObj = GetAvailableTradeObject(10);\\n\\n                    }\\n\\n                    if (targetTradeObj){\\n\\n                        CloseWindows(document.querySelectorAll('body > .container > .player-confirm .dialog-cell'), false);\\n\\n                        CloseWindows(document.querySelectorAll('.container > div:not(.hud):not(.player-confirm)'), true);\\n\\n                        Game.app.fire('SellClicked', {x: targetTradeObj.townX, z: targetTradeObj.townZ});\\n\\n                        await WaitForCompletion('.LoadingOrders');\\n\\n                        document.querySelector('#trade-craft-target \\\\[data-name=\\\"' + craftedItems\\\\[i\\\\].item + '\\\"\\\\]').click();\\n\\n                        await WaitForTradeLoad(targetTradeObj);\\n\\n                        if (Game.town.GetStoredCrafts()\\\\['Gasoline'\\\\] >= Game.app.root.findByName('TradeUi').script.trade.cityPaths\\\\[0\\\\].gasCost) {\\n\\n                            document.querySelector('#destination-target .destination .sell-button').click();\\n\\n                            await WaitForCompletion('.trade-connection .compass');\\n\\n                        } else {\\n\\n                            console.log('Whoops! You have run out of gas.');\\n\\n                            document.querySelector('#autosell-status .bank').textContent = 'ALERT: Out of gas!'\\n\\n                            document.querySelector('.container > .trade .close-button').click();\\n\\n                        }\\n\\n                    }\\n\\n                }\\n\\n            }\\n\\n        } else {\\n\\n            console.log('Whoops! You have run out of gas.');\\n\\n            document.querySelector('#autosell-status .bank').textContent = 'ALERT: Out of gas!'\\n\\n        }\\n\\n        setTimeout(CheckCrafts, 5000);\\n\\n    }\\n\\n \\n\\n    async function ActivateAutoSell() {\\n\\n        let autoSellStatus = document.createElement('div');\\n\\n        autoSellStatus.id = 'autosell-status';\\n\\n        autoSellStatus.style.cssText = 'pointer-events: all; position: absolute; left: 50%; transform: translate(-50%, 0);';\\n\\n        autoSellStatus.addEventListener( 'click', function(){this.children\\\\[0\\\\].textContent = 'Auto-Sell Active';})\\n\\n        let autoSellContent = document.createElement('div');\\n\\n        autoSellContent.classList.add('bank');\\n\\n        autoSellContent.style.cssText = 'background-color: #fde7e3; padding-left: 10px; padding-right: 10px';\\n\\n        autoSellContent.textContent = 'Auto-Sell Active';\\n\\n        autoSellStatus.appendChild(autoSellContent);\\n\\n        await WaitForElement('.hud');\\n\\n        document.querySelector('.hud').prepend(autoSellStatus);\\n\\n        CheckCrafts();\\n\\n    }\\n\\n \\n\\n})();\\n\\n \\n  \\n  \\n \",\"timestamp\":1634007132,\"title\":\"Town Star脚本教程 /加密大聪明\"},\"digest\":\"o382dYL-fYegWJNkfmGCEQ0m2mvHRvAYtNdlWzZYrAU\",\"authorship\":{\"contributor\":\"0xFBD69339f8871ad9263413Ce62F96a9A2E818355\",\"signingKey\":\"{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"7oB0371qUSEd5CzvVCvHoQ__3wy4fyJ3nzeVn8yZqOE\\\",\\\"y\\\":\\\"-j1jRutxbatSIaROzpEclNcnJFekuI2jLgRsmat3FRE\\\"}\",\"signature\":\"ktpuAMdCJJyze5nL5pd1oY5_CpU4cbZ1GR9I6NiaTPHJ7N059LHj40Lem6PCtiNxxXRTwbP0ZuJ20ZLk6Xq7jA\",\"signingKeySignature\":\"0x71faf1aa31ede97a4ae1e04fe568bdb2048d5e0286e502f3fc9283a220fa60e6076a9be3a36ea5b7529a5bde805a3b640439cbc3da067ab512f2ac5e730929e51b\",\"signingKeyMessage\":\"I authorize publishing on mirror.xyz from this device using:\\n{\\\"crv\\\":\\\"P-256\\\",\\\"ext\\\":true,\\\"key_ops\\\":[\\\"verify\\\"],\\\"kty\\\":\\\"EC\\\",\\\"x\\\":\\\"7oB0371qUSEd5CzvVCvHoQ__3wy4fyJ3nzeVn8yZqOE\\\",\\\"y\\\":\\\"-j1jRutxbatSIaROzpEclNcnJFekuI2jLgRsmat3FRE\\\"}\",\"algorithm\":{\"name\":\"ECDSA\",\"hash\":\"SHA-256\"}},\"nft\":{},\"version\":\"12-21-2020\",\"originalDigest\":\"o382dYL-fYegWJNkfmGCEQ0m2mvHRvAYtNdlWzZYrAU\"}"